{"version":3,"sources":["../src/single-spa-angularjs.js"],"names":["defaultOpts","angular","domElementGetter","mainAngularModule","uiRouter","ngRoute","preserveGlobal","elementId","strictDi","template","undefined","singleSpaAngularJS","userOpts","Error","opts","mountedInstances","bootstrap","bind","mount","unmount","singleSpaProps","Promise","resolve","then","module","err","config","$provide","value","props","window","chooseDomElementGetter","domElement","getRootDomEl","bootstrapEl","document","createElement","id","appendChild","uiViewEl","setAttribute","ngViewEl","innerHTML","instance","get","$apply","reject","has","dispose","console","warn","$destroy","setTimeout","defaultDomElementGetter","appName","name","htmlId","defaultDomEl","getElementById","body","element"],"mappings":"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","sourcesContent":["const defaultOpts = {\n  // required opts\n  angular: null,\n  domElementGetter: null,\n  mainAngularModule: null,\n\n  // optional opts\n  uiRouter: false,\n  ngRoute: false,\n  preserveGlobal: false,\n  elementId: \"__single_spa_angular_1\",\n  strictDi: false,\n  template: undefined,\n};\n\nexport default function singleSpaAngularJS(userOpts) {\n  if (typeof userOpts !== \"object\") {\n    throw new Error(`single-spa-angularjs requires a configuration object`);\n  }\n\n  const opts = {\n    ...defaultOpts,\n    ...userOpts,\n  };\n\n  if (!opts.angular) {\n    throw new Error(`single-spa-angularjs must be passed opts.angular`);\n  }\n\n  if (!opts.mainAngularModule) {\n    throw new Error(\n      `single-spa-angularjs must be passed opts.mainAngularModule string`\n    );\n  }\n\n  // A shared object to store mounted object state\n  const mountedInstances = {};\n\n  return {\n    bootstrap: bootstrap.bind(null, opts, mountedInstances),\n    mount: mount.bind(null, opts, mountedInstances),\n    unmount: unmount.bind(null, opts, mountedInstances),\n  };\n}\n\nfunction bootstrap(opts, mountedInstances, singleSpaProps) {\n  return Promise.resolve().then(() => {\n    let module;\n    try {\n      module = opts.angular.module(\"single-spa-angularjs\");\n    } catch (err) {\n      // ignore - this means that the module doesn't exist\n    }\n    if (module) {\n      module.config([\n        \"$provide\",\n        ($provide) => {\n          $provide.value(\"singleSpaProps\", singleSpaProps);\n        },\n      ]);\n    }\n  });\n}\n\nfunction mount(opts, mountedInstances, props = {}) {\n  return Promise.resolve().then(() => {\n    window.angular = opts.angular;\n\n    const domElementGetter = chooseDomElementGetter(opts, props);\n    const domElement = getRootDomEl(domElementGetter, props);\n    const bootstrapEl = document.createElement(\"div\");\n    bootstrapEl.id = opts.elementId;\n\n    domElement.appendChild(bootstrapEl);\n\n    if (opts.uiRouter) {\n      const uiViewEl = document.createElement(\"div\");\n      uiViewEl.setAttribute(\n        \"ui-view\",\n        opts.uiRouter === true ? \"\" : opts.uiRouter\n      );\n      bootstrapEl.appendChild(uiViewEl);\n    }\n\n    if(opts.ngRoute){\n        const ngViewEl = document.createElement(\"div\");\n        ngViewEl.setAttribute(\n            \"ng-view\",\"\"\n        );\n        bootstrapEl.appendChild(ngViewEl);\n    }\n\n    if (opts.template) {\n      bootstrapEl.innerHTML = opts.template;\n    }\n\n    if (opts.strictDi) {\n      mountedInstances.instance = opts.angular.bootstrap(\n        bootstrapEl,\n        [opts.mainAngularModule],\n        { strictDi: opts.strictDi }\n      );\n    } else {\n      mountedInstances.instance = opts.angular.bootstrap(bootstrapEl, [\n        opts.mainAngularModule,\n      ]);\n    }\n\n    mountedInstances.instance.get(\"$rootScope\").singleSpaProps = props;\n\n    // https://github.com/single-spa/single-spa-angularjs/issues/51\n    mountedInstances.instance.get(\"$rootScope\").$apply();\n  });\n}\n\nfunction unmount(opts, mountedInstances, props = {}) {\n  return new Promise((resolve, reject) => {\n    if (mountedInstances.instance.has(\"$uiRouter\")) {\n      // https://github.com/single-spa/single-spa-angularjs/issues/53\n      const uiRouter = mountedInstances.instance.get(\"$uiRouter\");\n      if (uiRouter.dispose) {\n        uiRouter.dispose();\n      } else {\n        console.warn(\n          \"single-spa-angularjs: the uiRouter instance doesn't have a dispose method and so it will not be properly unmounted.\"\n        );\n      }\n    }\n\n    mountedInstances.instance.get(\"$rootScope\").$destroy();\n    const domElementGetter = chooseDomElementGetter(opts, props);\n    const domElement = getRootDomEl(domElementGetter, props);\n\n    domElement.innerHTML = \"\";\n\n    if (opts.angular === window.angular && !opts.preserveGlobal)\n      delete window.angular;\n\n    setTimeout(resolve);\n  });\n}\n\nfunction chooseDomElementGetter(opts, props) {\n  if (props.domElement) {\n    return () => props.domElement;\n  } else if (props.domElementGetter) {\n    return props.domElementGetter;\n  } else if (opts.domElementGetter) {\n    return opts.domElementGetter;\n  } else {\n    return defaultDomElementGetter(props);\n  }\n}\n\nfunction defaultDomElementGetter(props) {\n  const appName = props.appName || props.name;\n  if (!appName) {\n    throw Error(\n      `single-spa-angularjs was not given an application name as a prop, so it can't make a unique dom element container for the angularjs application`\n    );\n  }\n  const htmlId = `single-spa-application:${appName}`;\n\n  return function defaultDomEl() {\n    let domElement = document.getElementById(htmlId);\n    if (!domElement) {\n      domElement = document.createElement(\"div\");\n      domElement.id = htmlId;\n      document.body.appendChild(domElement);\n    }\n\n    return domElement;\n  };\n}\n\nfunction getRootDomEl(domElementGetter, props) {\n  if (typeof domElementGetter !== \"function\") {\n    throw new Error(\n      `single-spa-angularjs: the domElementGetter for angularjs application '${\n        props.appName || props.name\n      }' is not a function`\n    );\n  }\n\n  const element = domElementGetter(props);\n\n  if (!element) {\n    throw new Error(\n      `single-spa-angularjs: domElementGetter function for application '${\n        props.appName || props.name\n      }' did not return a valid dom element. Please pass a valid domElement or domElementGetter via opts or props`\n    );\n  }\n\n  return element;\n}\n"],"file":"single-spa-angularjs.js"}